# GEOG5060M GIS and Environment Independent Research Project Assignment
This project developed a new tool for ArcGIS which conducts a temporal trend analysis of rasters on a per pixel basis using simple linear regression and a Theil-Sen estimator. The aim of this project was to calculate the slope of this simple linear regression model and a Theil-Sen estimation for each pixel of a series of inputted rasters to the tool. 

The result was Script tool for ArcGIS Pro which conducts a per pixel linear regression/Theil-Sen estimation on a time series of single band rasters.

## ArcGIS Pro interface
The GUI for the trend analysis tool in ArcGIS Pro prompts the user to select their desired timeseries rasters using file explorer. These must be in .tif format.The user then enters the relevant X variable – the time value – in the adjacent textbox to the corresponding input raster. The time values provided may be in any unit providing it is used consistently throughout all input rasters and in a numerical format. This allows for non-equidistant time values for the timeseries, which is often necessary when using satellite derived imagery due to high cloud cover preventing data collection. The user also provides the output file location they wish the output rasters to be saved in. Tick boxes allow the user to select the trend analysis method.

## Method
The Python script reads in the file directories for the rasters provided by ArcGIS Pro and splits them into separate list items, extracting the ‘No Data’ value, coordinate system and cell size. The time, or X values, are extracted from the user inputted values and sorted to align with the corresponding y variable. The inputted tif files are then stacked and an output, multi-band tif is created in the output directory of the stacked image. This is converted into a NumPy multidimensional array. Empty NumPy arrays are created using the width and height extents as the inputter rasters. 
The code then iterates through each pixel, creating a list of and y values for each pixel. Where there is a missing y value, the code identifies which x value this was associated with and removes that x value from the values inputted into the trend calculation. If there are no y values for a pixel, the No Data value from the input rasters is used in that cell for each of the output images. If there is 1 or no datapoints for a pixel, the trend analysis is not calculated, and the output pixel is set to the no data value. Depending on the tick boxes filled in by the user, a linear regression and/or Theil-Sen output is calculated for each pixel. The empty NumPy arrays are then populated with the regression outputs which consist of slope, p-value and standard error for the linear regression and slope, lower slope and upper slope for the Theil-Sen method. An additional raster is created expressing the number of input layers, or y values, used in the regression calculation for each pixel.

## Limitations
There are some limitations to the flexibility of the tool regarding input rasters. They must be in the form of a single band tif file. Whilst alternative file formats could be generated using ArcGIS Pro, extraction of single bands from a multiband raster set is less time and memory efficient in terms of analysis workflow. To mitigate this a separate tool could be created, based on the original, but with the user able to select the relevant input bands from a multidimensional raster. Currently, the raster inputted into the tool all need to be the same spatial extent and rectangular in shape. This type of rasters for trend analysis is a common occurrence, with satellite imagery with the same sensor paths, or larger rasters clipped to the same, smaller study area extent. However, to make the tool more robust future developments should include handling of input rasters of a multi-extent, potentially by the creation of an encompassing grid system and the relative alignment of the inputted rasters to that. Raster inputs must all have consistent cell sizing, as the tool does not take into account spatial projection of the inputted rasters, just the cell numbers as it works on an iteration through the cells and rows. A larger addition to the tool could be one which handles different cell sizes by an overlay of cells based on the projection and cell size of rasters. The output analysis could aggregate smaller cells to largest inputted raster resolution or resample the data at each pixel centroid onto a new raster grid.
